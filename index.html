<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competições de Futebol</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #1c1e21; }
        .page-container { display: flex; flex-direction: column; height: 100vh; }
        
        header { 
            padding: 10px 20px; 
            background-color: #ffffff; 
            border-bottom: 1px solid #dddfe2; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            position: relative;
            z-index: 20;
        }
        
        .logo-container { display: inline-flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; flex-shrink: 0; }
        .logo-image { height: 40px; width: 40px; }
        .logo-name { font-size: 1.5rem; font-weight: bold; letter-spacing: 1px; }

        #global-search-container { position: relative; flex-grow: 1; max-width: 600px; margin: 0 20px; }
        .search-wrapper-gradient { padding: 2px; border-radius: 20px; background: linear-gradient(90deg, #4285F4, #34A853, #FBBC05, #EA4335, #4285F4); background-size: 200% 200%; animation: gradient-animation 4s ease infinite; transition: box-shadow 0.2s; }
        .search-wrapper-gradient:focus-within { box-shadow: 0 0 8px rgba(0,0,0,0.2); }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #global-search-input { width: 100%; border: none; padding: 8px 15px; font-size: 1rem; border-radius: 18px; background-color: #f0f2f5; }
        #global-search-input:focus { outline: none; background-color: #fff; }
        #search-results-panel { display: none; position: absolute; top: 110%; left: 0; width: 100%; background-color: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 70vh; overflow-y: auto; padding: 10px; }
        .search-results-section h3 { font-size: 0.8rem; text-transform: uppercase; color: #606770; padding: 5px 10px; margin-bottom: 5px; }
        .search-result-item { display: block; text-decoration: none; color: inherit; padding: 10px; border-radius: 8px; margin-bottom: 8px; position: relative; border: 1px solid transparent; transition: background-color 0.2s; }
        .result-type-comp { background-color: #f0f5ff; border-color: #dde8ff; }
        .result-type-team { background-color: #f0fff5; border-color: #ddffe8; }
        .search-result-item:hover { background-color: #e9ecef; }
        .result-header { text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px; }
        .result-logo { width: 32px; height: 32px; object-fit: contain; }
        .result-name-container .main-name { font-weight: 600; }
        .result-name-container .sub-name { font-size: 0.8rem; color: #606770; }
        .result-flag { position: absolute; top: 8px; left: 8px; width: 20px; height: 15px; object-fit: cover; border-radius: 2px; box-shadow: 0 0 2px rgba(0,0,0,0.3); }
        .result-pickcards-container { display: flex; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .result-pickcard { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px; background-color: #fff; border-radius: 6px; border: 1px solid #ddd; text-decoration: none; }
        .result-pickcard:hover { border-color: #007bff; }
        .result-pickcard img { width: 24px; height: 24px; object-fit: contain; }
        .result-pickcard span { font-size: 0.8rem; font-weight: bold; margin: 0 5px; }

        .content-wrapper { display: flex; flex-grow: 1; overflow: hidden; }
        .sidebar { width: 280px; flex-shrink: 0; background-color: #ffffff; padding: 15px; overflow-y: auto; border-right: 1px solid #dddfe2; display: flex; flex-direction: column;}
        #sidebar-search-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 15px; font-size: 0.9rem; }
        #competition-list { flex-grow: 1; overflow-y: auto; }
        .competition-item { display: flex; align-items: center; padding: 8px 10px; border-radius: 8px; margin-bottom: 6px; text-decoration: none; color: inherit; transition: background-color 0.2s ease-in-out; }
        .competition-item:hover { background-color: #f0f2f5; }
        .competition-logo { width: 24px; height: 24px; object-fit: contain; margin-right: 10px; }
        .competition-name { font-weight: 500; font-size: 0.85rem; }
        
        /* --- ESTILOS PARA A NOVA SIDEBAR --- */
        .sidebar-divider { margin: 12px 0; border: none; border-top: 1px solid #dddfe2; }
        .country-group { margin-bottom: 4px; }
        .country-header { display: flex; align-items: center; padding: 8px 10px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease-in-out; position: relative; }
        .country-header:hover { background-color: #f0f2f5; }
        .country-header.active { background-color: #e7f3ff; }
        .country-header::after { content: '›'; font-size: 1.5rem; color: #606770; position: absolute; right: 10px; transition: transform 0.3s ease; }
        .country-header.active::after { transform: rotate(90deg); }
        .country-flag { width: 24px; height: 16px; object-fit: cover; margin-right: 10px; border: 1px solid #eee; border-radius: 2px; }
        .country-name { font-weight: 500; font-size: 0.9rem; }
        .country-competitions-list { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; padding-left: 15px; margin-left: 18px; border-left: 2px solid #e9ecef; }
        .competition-item.nested { padding-left: 5px; }
        .competition-item.nested .competition-name { font-weight: 400; font-size: 0.8rem; }
        
        .main-content-scroll-container { flex-grow: 1; overflow-y: auto; background-color: #f9f9f9; }
        .main-content { padding: 20px; }
        .main-content h2 { font-size: 1.5rem; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .loading-message { color: #888; }
        #highlights-filter-container { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; margin-top: -5px; }
        .highlight-filter-btn { padding: 8px 16px; border: 1px solid #ccc; border-radius: 16px; background-color: #fff; cursor: pointer; font-weight: 500; font-size: 0.85rem; transition: all 0.2s ease; }
        .highlight-filter-btn:hover { background-color: #e4e6eb; border-color: #bbb; }
        .highlight-filter-btn.active { background-color: #1877f2 !important; color: #fff !important; border-color: #1877f2 !important; }
        #latest-games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .game-card { background-color: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: relative; display: flex; flex-direction: column; justify-content: center; text-decoration: none; color: inherit; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .game-card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .game-card-comp-logo { position: absolute; top: 10px; left: 10px; height: 24px; width: 24px; object-fit: contain; background: rgba(255,255,255,0.7); border-radius: 50%; padding: 2px;}
        .game-card-jornada { position: absolute; top: 10px; right: 10px; background-color: #f0f2f5; color: #606770; font-size: 0.7rem; padding: 3px 7px; border-radius: 6px; font-weight: bold; }
        .game-card-content { display: flex; align-items: center; justify-content: space-around; width: 100%; margin-top: 15px; }
        .game-card-team img { height: 45px; width: 45px; object-fit: contain; }
        .game-card-result { font-size: 1.5rem; font-weight: bold; margin: 0 10px; }
        .list-wrapper { background-color: #ffffff; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: relative; }
        #filter-bar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; position: sticky; top: 0; z-index: 10; background-color: #ffffff; padding-bottom: 20px; border-bottom: 1px solid #eee; margin: -20px -20px 0 -20px; padding: 15px 20px; width: calc(100% + 40px); border-radius: 12px 12px 0 0; }
        #search-input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; flex-grow: 1; min-width: 200px; }
        .filter-btn, #date-input { padding: 10px 15px; background-color: #f0f2f5; color: #333; border: 1px solid #ccc; border-radius: 6px; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        .filter-btn:hover, #date-input:hover { background-color: #e4e6eb; border-color: #bbb; }
        #full-games-list { padding-top: 20px; }
        .date-header { font-size: 1.1rem; font-weight: bold; color: #333; margin-top: 15px; margin-bottom: 5px; }
        .match-list-item { display: grid; grid-template-columns: 28px 1fr auto; align-items: center; gap: 10px; background-color: #fff; padding: 8px 12px; border-radius: 8px; border: 1px solid #eee; text-decoration: none; color: inherit; }
        .match-list-item:hover { background-color: #f9f9f9; border-color: #ccc; }
        .match-list-item .list-item-flag { height: 20px; width: 28px; object-fit: cover; border: 1px solid #eee; }
        .match-list-item .game-name { font-size: 0.9rem; font-weight: 500; }
        .game-name .competition-subtitle { font-size: 0.75rem; font-style: italic; font-weight: 400; color: #555; margin-left: 8px; }
        .match-list-item .game-jornada { font-size: 0.8rem; color: #666; text-align: right; }
        .result-name-container .sub-name { font-size: 0.8rem; font-style: italic; color: #606770; }
        .main-name .sub-name { font-size: 0.9em; font-style: italic; font-weight: 400; color: #606770; margin-left: 8px; }

     .site-footer {
    background-color: #343a40;
    color: #f8f9fa;
    padding: 12px 20px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    font-size: 0.9rem;
    font-weight: 500;
    flex-shrink: 0;
    border-top: 1px solid #212529;

    /* ADIÇÕES PARA O EFEITO DE FADE-IN */
    opacity: 0;                      /* Começa invisível */
    visibility: hidden;              /* Começa oculto e não interativo */
    transition: opacity 0.5s ease-in-out; /* Define a animação de fade */
}

/* --- 2. ADICIONE ESTA NOVA REGRA COMPLETA --- */
.site-footer.visible {
    opacity: 1;         /* Fica totalmente visível */
    visibility: visible;  /* Torna-se visível e interativo */
}

.country-match-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    margin-top: 10px;
    background-color: #f0f2f5;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
}
.country-match-header img {
    height: 20px;
    width: 28px;
    object-fit: cover;
    border: 1px solid #ddd;
}

    </style>
</head>
<body>
    <div class="page-container">
        <header>
            <a href="index.html" class="logo-container">
                <img src="https://cdn-icons-png.flaticon.com/512/17214/17214595.png" alt="VARSOCCER Logo" class="logo-image">
                <span class="logo-name">VARSOCCER</span>
            </a>
            <div id="global-search-container">
                <div class="search-wrapper-gradient"><input type="text" id="global-search-input" placeholder="Search Teams or Competitions..."></div>
                <div id="search-results-panel"></div>
            </div>
            <div style="width: 200px; flex-shrink: 0;"></div>
        </header>

        <div class="content-wrapper">
            <nav class="sidebar">
                <input type="text" id="sidebar-search-input" placeholder="Search competition...">
                <div id="competition-list"><p class="loading-message">Loading...</p></div>
            </nav>
            <div class="main-content-scroll-container">
                <main class="main-content">
                    <h2>Latest Highlights</h2>
                    <div id="highlights-filter-container"></div>
                    <div id="latest-games-grid"><p class="loading-message">Latest matches...</p></div>
                    <section id="all-games-section">
                        <h2>Latest Matches</h2>
                        <div class="list-wrapper">
                            <div id="filter-bar">
                                <input type="text" id="search-input" placeholder="Search your Match or Team">
                                <button id="all-btn" class="filter-btn">ALL</button>
                                <button id="yesterday-btn" class="filter-btn">YESTERDAY (0)</button>
                                <button id="today-btn" class="filter-btn">TODAY (0)</button>
                                <a href="calendar.html" class="filter-btn" style="text-decoration: none;">Choose a date...</a>
                            </div>
                            <div id="full-games-list"><p class="loading-message">Loading matches...</p></div>
                        </div>
                    </section>
                </main>

                <!-- ADIÇÃO: Rodapé com estatísticas -->
                <footer class="site-footer">
                    <div class="stat-item">Teams: <span id="stats-teams-count">--</span></div>
                    <div class="stat-item">Competitions: <span id="stats-competitions-count">--</span></div>
                    <div class="stat-item">Matches: <span id="stats-matches-count">--</span></div>
                </footer>

            </div>





    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBa6zi1FV_WFkatQW-w2vb_votXJ43p76o", authDomain: "varsoccer-26040.firebaseapp.com", projectId: "varsoccer-26040", storageBucket: "varsoccer-26040.firebasestorage.app", messagingSenderId: "11877829810", appId: "1:11877829810:web:98f9baa131a3b88b6e8dab" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let clubsMap = new Map();
        let competitionsMap = new Map();
        let countriesMap = new Map();
        let allFetchedGames = [];

        // --- FUNÇÕES AUXILIARES ---
        const formatDate = (date) => new Date(date).toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit', year: 'numeric' });
        
        function parseDate(dateString) {
            if (!dateString) return new Date(null);
            if (dateString.includes('-')) { return new Date(dateString); }
            const parts = dateString.split('/');
            if (parts.length === 3) { return new Date(parts[2], parts[1] - 1, parts[0]); }
            return new Date(null);
        }
        
        async function fetchAndStoreClubs() { if (clubsMap.size > 0) return; const s = await getDocs(collection(db, 'clubes')); s.forEach(d => clubsMap.set(d.id, { id: d.id, ...d.data() })); }
        async function fetchAndStoreCompetitions() { competitionsMap.clear(); const s = await getDocs(query(collection(db, 'competicoes'), orderBy('nome'))); s.forEach(d => competitionsMap.set(d.id, { id: d.id, ...d.data() })); }
        async function fetchAndStoreCountries() { if (countriesMap.size > 0) return; const s = await getDocs(collection(db, 'paises')); s.forEach(d => countriesMap.set(d.id, { id: d.id, ...d.data()})); }
        
        // --- FUNÇÕES DE RENDERIZAÇÃO DA SIDEBAR ---
        async function fetchAndRenderSidebar() {
            const listElement = document.getElementById('competition-list');
            try {
                const topCompetitions = [];
                const competitionsByCountry = new Map();

                for (const comp of competitionsMap.values()) {
                    if (comp.posicaoMenu && !isNaN(parseInt(comp.posicaoMenu))) {
                        topCompetitions.push(comp);
                    }
                    if (comp.paisId) {
                        if (!competitionsByCountry.has(comp.paisId)) {
                            competitionsByCountry.set(comp.paisId, []);
                        }
                        competitionsByCountry.get(comp.paisId).push(comp);
                    }
                }

                topCompetitions.sort((a, b) => a.posicaoMenu - b.posicaoMenu);

                const countriesWithCompetitions = [];
                for (const paisId of competitionsByCountry.keys()) {
                    if (countriesMap.has(paisId)) {
                        countriesWithCompetitions.push(countriesMap.get(paisId));
                    }
                }
                countriesWithCompetitions.sort((a, b) => a.nome.localeCompare(b.nome));

                let html = '';
                topCompetitions.forEach(comp => {
                    html += `<a href="competition.html?id=${comp.id}" class="competition-item" data-namming="${comp.namming || ''}"><img src="${comp.logoUrl}" class="competition-logo"><span class="competition-name">${comp.nome}</span></a>`;
                });

                if (topCompetitions.length > 0 && countriesWithCompetitions.length > 0) {
                    html += `<hr class="sidebar-divider">`;
                }
                
                countriesWithCompetitions.forEach(country => {
                    const countryId = country.id;
                    const compsOfCountry = competitionsByCountry.get(countryId) || [];
                    
                    html += `
                        <div class="country-group">
                            <div class="country-header" data-country-id="${countryId}">
                                <img src="${country.bandeiraUrl}" class="country-flag" alt="${country.nome}">
                                <span class="country-name">${country.nome}</span>
                            </div>
                            <div class="country-competitions-list" id="comps-for-${countryId}">
                                ${compsOfCountry.map(comp => `
                                    <a href="competition.html?id=${comp.id}" class="competition-item nested" data-namming="${comp.namming || ''}">
                                        <img src="${comp.logoUrl}" class="competition-logo">
                                        <span class="competition-name">${comp.nome}</span>
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                listElement.innerHTML = html || '<p>No competition found.</p>';

                listElement.addEventListener('click', function(event) {
                    const header = event.target.closest('.country-header');
                    if (!header) return;

                    const content = header.nextElementSibling;
                    header.classList.toggle('active');

                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });

            } catch (error) {
                console.error("Error loading sidebar:", error);
                listElement.innerHTML = '<p>Error loading.</p>';
            }
        }

        function setupSidebarFilter() {
            const searchInput = document.getElementById('sidebar-search-input');
            const competitionListContainer = document.getElementById('competition-list');

            searchInput.addEventListener('keyup', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const isSearching = searchTerm.length > 0;

                const topLevelItems = competitionListContainer.querySelectorAll(':scope > .competition-item');
                const divider = competitionListContainer.querySelector('.sidebar-divider');
                const countryGroups = competitionListContainer.querySelectorAll('.country-group');
                
                topLevelItems.forEach(item => {
                    item.style.display = isSearching ? 'none' : 'flex';
                });

                if (divider) {
                    divider.style.display = isSearching ? 'none' : 'block';
                }

                countryGroups.forEach(group => {
                    const countryName = group.querySelector('.country-name').textContent.toLowerCase();
                    const nestedComps = group.querySelectorAll('.competition-item.nested');
                    const header = group.querySelector('.country-header');
                    const contentList = group.querySelector('.country-competitions-list');

                    let hasVisibleChildren = false;

                    nestedComps.forEach(comp => {
                        const compName = comp.querySelector('.competition-name').textContent.toLowerCase();
                        const compNamming = (comp.dataset.namming || '').toLowerCase();
                        const isCompVisible = compName.includes(searchTerm) || compNamming.includes(searchTerm);
                        
                        comp.style.display = isCompVisible ? 'flex' : 'none';
                        
                        if (isCompVisible) {
                            hasVisibleChildren = true;
                        }
                    });

                    const isGroupVisible = countryName.includes(searchTerm) || hasVisibleChildren;
                    group.style.display = isGroupVisible ? 'block' : 'none';

                    const shouldExpand = isSearching && hasVisibleChildren;

                    if (shouldExpand) {
                        header.classList.add('active');
                        contentList.style.maxHeight = contentList.scrollHeight + "px";
                    } else {
                        header.classList.remove('active');
                        contentList.style.maxHeight = null;
                    }
                });
            });
        }
        
        // --- FUNÇÕES DE RENDERIZAÇÃO DO CONTEÚDO PRINCIPAL ---
        function renderHighlightsFilters() {
            const container = document.getElementById('highlights-filter-container');
            const grid = document.getElementById('latest-games-grid');
            container.innerHTML = '';
            const buttonColors = ['#0C1EA5', '#5F9EA0', '#C45903', '#3D722B', '#6f42c1', '#dc3545', '#20c997', '#d63384', '#6610f2', '#8B4513', '#495057'];
            const competitionsForFilter = Array.from(competitionsMap.values()).filter(comp => comp.noTopoMenu === 'Yes');
            if (competitionsForFilter.length === 0) { container.style.display = 'none'; return; }
            container.style.display = 'flex';
            container.innerHTML = `<button class="highlight-filter-btn active" data-comp-id="all">All</button>`;
            competitionsForFilter.forEach((comp, index) => {
                const color = buttonColors[index % buttonColors.length];
                container.innerHTML += `<button class="highlight-filter-btn" data-comp-id="${comp.id}" style="background-color: ${color}; border-color: ${color}; color: white;">${comp.nome}</button>`;
            });
            container.addEventListener('click', async (e) => {
                if (e.target.tagName !== 'BUTTON') return;
                const currentActive = container.querySelector('.highlight-filter-btn.active');
                if (currentActive) { currentActive.classList.remove('active'); }
                e.target.classList.add('active');
                const compId = e.target.dataset.compId;
                if (compId === 'all') { renderLatestFive(allFetchedGames); } 
                else {
                    grid.innerHTML = '<p class="loading-message">Loading competition matches...</p>';
                    try {
                        const q = query(collection(db, 'jogos'), where("competicaoId", "==", compId), orderBy("dataJogo", "desc"), limit(5));
                        const snapshot = await getDocs(q);
                        const competitionGames = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const now = new Date();
                        now.setHours(0, 0, 0, 0);
                        const filteredCompetitionGames = competitionGames.filter(game => {
                            const gameDate = parseDate(game.dataJogo);
                            if (isNaN(gameDate.getTime())) return true;
                            const isFutureGame = gameDate > now;
                            const hasInvalidResult = !game.resultadoFinal || game.resultadoFinal.trim() === "" || game.resultadoFinal.toUpperCase() === 'X';
                            return !(isFutureGame && hasInvalidResult);
                        });
                        renderLatestFive(filteredCompetitionGames);
                    } catch (error) { console.error("Erro ao buscar jogos da competição:", error); grid.innerHTML = '<p>Error loading matches.</p>'; }
                }
            });
        }
        
        function renderLatestFive(games) {
            const grid = document.getElementById('latest-games-grid');
            if (!games || games.length === 0) { grid.innerHTML = '<p>No recent matches found for this filter.</p>'; return; }
            grid.innerHTML = '';
            const sortedGames = [...games].sort((a, b) => parseDate(b.dataJogo) - parseDate(a.dataJogo)).slice(0, 5);
            sortedGames.forEach(game => {
                const comp = competitionsMap.get(game.competicaoId);
                const home = clubsMap.get(game.equipaCasaId);
                const away = clubsMap.get(game.equipaForaId);
                if (!comp || !home || !away) return;
                grid.innerHTML += `<a href="game.html?id=${game.id}" class="game-card"><img src="${comp.logoUrl}" class="game-card-comp-logo" title="${comp.nome}"><div class="game-card-jornada">Round ${game.jornada}</div><div class="game-card-content"><div class="game-card-team"><img src="${home.logoUrl}" title="${home.nome}"></div><span class="game-card-result">${game.resultadoFinal || 'VS'}</span><div class="game-card-team"><img src="${away.logoUrl}" title="${away.nome}"></div></div></a>`;
            });
        }
        
  function renderFullList(games) {
    const listContainer = document.getElementById('full-games-list');
    if (games.length === 0) {
        listContainer.innerHTML = '<p>Nenhum jogo encontrado.</p>';
        return;
    }
    listContainer.innerHTML = '';

    // 1. Agrupar jogos por data
    const gamesByDate = games.reduce((acc, game) => {
        const dateKey = formatDate(game.dataJogo);
        if (!acc[dateKey]) acc[dateKey] = [];
        acc[dateKey].push(game);
        return acc;
    }, {});

    // 2. Iterar sobre cada data, da mais recente para a mais antiga
    Object.keys(gamesByDate).sort((a, b) => parseDate(b) - parseDate(a)).forEach(date => {
        listContainer.innerHTML += `<h3 class="date-header">${date}</h3>`;

        const gamesForThisDay = gamesByDate[date];

        // 3. ORDENAR a lista de jogos do dia usando múltiplos critérios
        gamesForThisDay.sort((gameA, gameB) => {
            const compA = competitionsMap.get(gameA.competicaoId);
            const compB = competitionsMap.get(gameB.competicaoId);

            const countryNameA = countriesMap.get(compA?.paisId)?.nome || '';
            const countryNameB = countriesMap.get(compB?.paisId)?.nome || '';
            const compNameA = compA?.nome || '';
            const compNameB = compB?.nome || '';

            // Critério 1: Ordenar por nome do País (alfabético)
            const countryComparison = countryNameA.localeCompare(countryNameB);
            if (countryComparison !== 0) {
                return countryComparison;
            }

            // Critério 2: Se o país for o mesmo, ordenar por nome da Competição (alfabético)
            const compComparison = compNameA.localeCompare(compNameB);
            if (compComparison !== 0) {
                return compComparison;
            }
            
            // Critério 3: Se a competição for a mesma, ordenar por nome do Jogo (alfabético)
            // <<< LINHA CORRIGIDA
            return gameA.nomeJogo.localeCompare(gameB.nomeJogo);
        });

        // 4. Renderizar a lista de jogos já ordenada
        gamesForThisDay.forEach(game => {
            const comp = competitionsMap.get(game.competicaoId);
            const country = comp ? countriesMap.get(comp.paisId) : null;
            
            let competitionNameSuffix = (comp && (comp.escalao === 'Inferior' || comp.tipo === 'Doméstica Taça')) ? ` <span class="competition-subtitle">(${comp.nome})</span>` : '';
            
            listContainer.innerHTML += `
                <a href="game.html?id=${game.id}" class="match-list-item">
                    <img src="${country?.bandeiraUrl || ''}" class="list-item-flag" title="${country?.nome || ''}">
                    <span class="game-name">${game.nomeJogo}${competitionNameSuffix}</span>
                    <span class="game-jornada">Round ${game.jornada}</span>
                </a>`;
        });
    });
}
        
        function setupFilters(games) {
            const searchInput = document.getElementById('search-input');
            const [allBtn, yesterdayBtn, todayBtn] = [document.getElementById('all-btn'), document.getElementById('yesterday-btn'), document.getElementById('today-btn')];
            const todayStr = new Date().toISOString().slice(0, 10);
            const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().slice(0, 10);
            todayBtn.textContent = `TODAY (${games.filter(g => g.dataJogo.startsWith(todayStr)).length})`;
            yesterdayBtn.textContent = `YESTERDAY (${games.filter(g => g.dataJogo.startsWith(yesterdayStr)).length})`;
            const applyFilter = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredGames = games.filter(g => {
                    const home = clubsMap.get(g.equipaCasaId)?.nome.toLowerCase() || '';
                    const away = clubsMap.get(g.equipaForaId)?.nome.toLowerCase() || '';
                    return g.nomeJogo.toLowerCase().includes(searchTerm) || home.includes(searchTerm) || away.includes(searchTerm);
                });
                renderFullList(filteredGames);
            };
            searchInput.addEventListener('keyup', applyFilter);
            allBtn.addEventListener('click', () => { searchInput.value = ''; renderFullList(games); });
            todayBtn.addEventListener('click', () => { searchInput.value = ''; renderFullList(games.filter(g => g.dataJogo.startsWith(todayStr))); });
            yesterdayBtn.addEventListener('click', () => { searchInput.value = ''; renderFullList(games.filter(g => g.dataJogo.startsWith(yesterdayStr))); });
        }

        // --- FUNÇÕES DA PESQUISA GLOBAL ---
        async function fetchLastGamesForTeam(teamId, limitNum = 3) {
            try {
                const homeGamesQuery = query(collection(db, "jogos"), where("equipaCasaId", "==", teamId));
                const awayGamesQuery = query(collection(db, "jogos"), where("equipaForaId", "==", teamId));
                const [homeSnapshot, awaySnapshot] = await Promise.all([getDocs(homeGamesQuery), getDocs(awayGamesQuery)]);
                const homeGames = homeSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const awayGames = awaySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const allGames = Array.from(new Map([...homeGames, ...awayGames].map(game => [game.id, game])).values());

                const validRecentGames = allGames
                    .filter(game => {
                        const result = game.resultadoFinal;
                        return result && result.trim() !== '' && result.toUpperCase() !== 'X';
                    })
                    .sort((a, b) => new Date(b.dataJogo) - new Date(a.dataJogo))
                    .slice(0, limitNum);

                return validRecentGames;
            } catch (error) {
                console.error(`Erro ao buscar jogos para a equipa ${teamId}:`, error);
                return [];
            }
        }

        async function loadAndRenderPickcards(teamId, type) {
            const containerId = `pickcards-for-${type}-${teamId}`;
            const container = document.getElementById(containerId);
            if (!container) return;

            let games = await fetchLastGamesForTeam(teamId);

            if (games.length > 0) {
                container.innerHTML = games.map(game => {
                    const home = clubsMap.get(game.equipaCasaId);
                    const away = clubsMap.get(game.equipaForaId);
                    if (home && away) {
                        return `<a href="game.html?id=${game.id}" class="result-pickcard" title="${game.nomeJogo}"><img src="${home.logoUrl}" alt="${home.nome}"><span>${game.resultadoFinal}</span><img src="${away.logoUrl}" alt="${away.nome}"></a>`;
                    }
                    return '';
                }).join('');
            } else {
                container.innerHTML = `<span style="font-size:0.8rem; color:#888;">No recent games found.</span>`;
            }
        }
        
        function findRecentTeamsForCompetition(compId, limit = 3) { const r=allFetchedGames.filter(g=>g.competicaoId===compId).sort((a,b)=>new Date(b.dataJogo)-new Date(a.dataJogo)),t=new Set;return r.forEach(g=>{t.size<2*limit&&(t.add(g.equipaCasaId),t.add(g.equipaForaId))}),Array.from(t).sort(()=>.5-Math.random()).slice(0,limit).map(id=>clubsMap.get(id)) }

        function renderSearchResults(teams, competitions) {
            const panel = document.getElementById('search-results-panel');
            if (teams.length === 0 && competitions.length === 0) { panel.style.display = 'none'; return; }
            let html = '';

            if (competitions.length > 0) {
                html += '<div class="search-results-section"><h3>Competitions</h3>';
                competitions.forEach(comp => {
                    const country = countriesMap.get(comp.paisId);
                    const recentTeams = findRecentTeamsForCompetition(comp.id);
                    html += `<div class="search-result-item result-type-comp">${country?`<img src="${country.bandeiraUrl}" alt="${country.nome}" class="result-flag">`:""}<a href="competition.html?id=${comp.id}" class="result-header"><img src="${comp.logoUrl}" class="result-logo"><div class="result-name-container"><div class="main-name">${comp.nome}${comp.namming ? ` <span class="sub-name">(${comp.namming})</span>` : ''}</div></div></a><div class="result-pickcards-container">${recentTeams.map(team=>team?`<a href="team.html?id=${team.id}" class="result-pickcard" title="${team.nome}"><img src="${team.logoUrl}" alt="${team.nome}"></a>`:"").join("")}</div></div>`;
                });
                html += '</div>';
            }
            if (teams.length > 0) {
                html += '<div class="search-results-section"><h3>Teams</h3>';
                teams.forEach(team => {
                    const country = countriesMap.get(team.paisId);
                    html += `<div class="search-result-item result-type-team">${country?`<img src="${country.bandeiraUrl}" alt="${country.nome}" class="result-flag">`:""}<a href="team.html?id=${team.id}" class="result-header"><img src="${team.logoUrl}" class="result-logo"><div class="result-name-container"><div class="main-name">${team.nome}</div></div></a><div class="result-pickcards-container" id="pickcards-for-team-${team.id}"><span style="font-size:0.8rem; color:#888;">Loading games...</span></div></div>`;
                });
                html += '</div>';
            }
            panel.innerHTML = html;
            panel.style.display = 'block';
            teams.forEach(team => { loadAndRenderPickcards(team.id, 'team'); });
        }
        
        function setupGlobalSearch() {
            const inputElement = document.getElementById('global-search-input');
            const panelElement = document.getElementById('search-results-panel');
            let debounceTimer;
            inputElement.addEventListener('input', (event) => {
                clearTimeout(debounceTimer);
                const searchTerm = event.target.value.toLowerCase();
                if (searchTerm.length < 2) { panelElement.style.display = 'none'; return; }
                debounceTimer = setTimeout(() => {
                    const filteredTeams = Array.from(clubsMap.values()).filter(team => team.nome.toLowerCase().includes(searchTerm));
                    const filteredCompetitions = Array.from(competitionsMap.values()).filter(comp => comp.nome.toLowerCase().includes(searchTerm) || (comp.namming && comp.namming.toLowerCase().includes(searchTerm)));
                    renderSearchResults(filteredTeams, filteredCompetitions);
                }, 300);
            });
            inputElement.addEventListener('focus', () => { if (inputElement.value.length > 1) { inputElement.dispatchEvent(new Event('input')); } });
            document.addEventListener('click', (event) => { if (!document.getElementById('global-search-container').contains(event.target)) { panelElement.style.display = 'none'; } });
        }

        async function updateStatsFooter() {
    const teamsCountEl = document.getElementById('stats-teams-count');
    const competitionsCountEl = document.getElementById('stats-competitions-count');
    const matchesCountEl = document.getElementById('stats-matches-count');

    // 1. Contar equipas e competições (usando dados já carregados)
    teamsCountEl.textContent = clubsMap.size;
    competitionsCountEl.textContent = competitionsMap.size;

    // 2. Contar jogos finalizados (requer uma nova busca para garantir a contagem total)
    // Nota: Esta operação busca todos os documentos de jogos para uma contagem precisa.
    try {
        const gamesQuery = query(collection(db, 'jogos'));
        const gamesSnapshot = await getDocs(gamesQuery);
        let playedGamesCount = 0;
        
        gamesSnapshot.forEach(doc => {
            const result = doc.data().resultadoFinal;
            // A condição verifica se o resultado não é nulo, vazio, ou 'X'.
            if (result && result.trim() !== '' && result.toUpperCase() !== 'X') {
                playedGamesCount++;
            }
        });
        matchesCountEl.textContent = playedGamesCount;
    } catch (error) {
        console.error("Error counting matches for stats footer:", error);
        matchesCountEl.textContent = "Error";
    }
}



        async function refreshGameDataAndUpdateUI() {
            try {
                const now = new Date();
                const endOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
                const endOfTodayISO = endOfToday.toISOString().slice(0, 10);

                const gamesQuery = query(
                    collection(db, 'jogos'), 
                    where("dataJogo", "<=", endOfTodayISO),
                    orderBy("dataJogo", "desc"), 
                    limit(100)
                );
                
                const snapshot = await getDocs(gamesQuery);
                allFetchedGames = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));

                renderHighlightsFilters();
                renderLatestFive(allFetchedGames);
                renderFullList(allFetchedGames);
                setupFilters(allFetchedGames);
            } catch(e) { 
                console.error("Error refreshing game data:", e);
                document.getElementById('latest-games-grid').innerHTML = '<p>Error loading matches.</p>';
                document.getElementById('full-games-list').innerHTML = '<p>Error loading matches.</p>';
            }
        }

    async function initializePage() {
    await Promise.all([ fetchAndStoreClubs(), fetchAndStoreCompetitions(), fetchAndStoreCountries() ]);
    await fetchAndRenderSidebar();
    setupSidebarFilter();
    await refreshGameDataAndUpdateUI(); 
    setupGlobalSearch();
    await updateStatsFooter();

    // ADIÇÃO: Lógica para mostrar o rodapé com atraso
    setTimeout(() => {
        const footer = document.querySelector('.site-footer');
        if (footer) {
            footer.classList.add('visible');
        }
    }, 2000); // 2000 milissegundos = 2 segundos

    const refreshInterval = 10 * 60 * 1000;
    setInterval(refreshGameDataAndUpdateUI, refreshInterval);
}

        initializePage();
    </script>
</body>
</html>
